<div class="container mx-auto p-6 max-w-4xl">
  <p-card>
    <ng-template pTemplate="header">
      <div class="p-4">
        <h2 class="text-2xl font-bold">{{ isEditMode() ? 'Edit Expense' : 'Add New Expense' }}</h2>
      </div>
    </ng-template>

    <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Expense Type -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Type <span class="text-red-500">*</span>
          </label>
          <select
            formControlName="type"
            class="w-full px-3 py-2 border border-gray-300 rounded-md"
            [class.border-red-500]="type?.invalid && type?.touched">
            <option value="">Select Type</option>
            @for (expenseType of expenseTypes; track expenseType) {
              <option [value]="expenseType">{{ expenseType }}</option>
            }
          </select>
          @if (type?.invalid && type?.touched) {
            <small class="text-red-500">Type is required</small>
          }
          <small class="text-gray-500 block mt-1">
            FIXED: Recurring monthly | VARIABLE: One-time | SHARED: Distributed across branches
          </small>
        </div>

        <!-- Category -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Category <span class="text-red-500">*</span>
          </label>
          <select
            formControlName="category"
            class="w-full px-3 py-2 border border-gray-300 rounded-md"
            [class.border-red-500]="category?.invalid && category?.touched">
            <option value="">Select Category</option>
            @for (cat of expenseCategories; track cat) {
              <option [value]="cat">{{ cat }}</option>
            }
          </select>
          @if (category?.invalid && category?.touched) {
            <small class="text-red-500">Category is required</small>
          }
        </div>

        <!-- Branch (only for FIXED and VARIABLE) -->
        @if (expenseForm.get('type')?.value !== 'SHARED') {
          <div>
            <label class="block text-sm font-medium mb-2">
              Branch <span class="text-red-500">*</span>
            </label>
            <select
              formControlName="branchId"
              class="w-full px-3 py-2 border border-gray-300 rounded-md"
              [class.border-red-500]="branchId?.invalid && branchId?.touched">
              <option value="">Select Branch</option>
              @for (branch of branches(); track branch.id) {
                <option [value]="branch.id">{{ branch.name }}</option>
              }
            </select>
            @if (branchId?.invalid && branchId?.touched) {
              <small class="text-red-500">Branch is required</small>
            }
          </div>
        }

        <!-- Distribution Method (only for SHARED) -->
        @if (expenseForm.get('type')?.value === 'SHARED') {
          <div>
            <label class="block text-sm font-medium mb-2">
              Distribution Method <span class="text-red-500">*</span>
            </label>
            <select
              formControlName="distributionMethod"
              class="w-full px-3 py-2 border border-gray-300 rounded-md"
              [class.border-red-500]="distributionMethod?.invalid && distributionMethod?.touched">
              @for (method of distributionMethods; track method) {
                <option [value]="method">{{ method }}</option>
              }
            </select>
            @if (distributionMethod?.invalid && distributionMethod?.touched) {
              <small class="text-red-500">Distribution method is required</small>
            }
            <small class="text-gray-500 block mt-1">
              EQUAL: Divide equally | PROPORTIONAL: Based on revenue
            </small>
          </div>
        }

        <!-- Amount -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Amount <span class="text-red-500">*</span>
          </label>
          <input
            type="number"
            formControlName="amount"
            step="0.01"
            class="w-full px-3 py-2 border border-gray-300 rounded-md"
            [class.border-red-500]="amount?.invalid && amount?.touched" />
          @if (amount?.invalid && amount?.touched) {
            <small class="text-red-500">Valid amount is required</small>
          }
        </div>

        <!-- Date -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Date <span class="text-red-500">*</span>
          </label>
          <input
            type="date"
            formControlName="date"
            class="w-full px-3 py-2 border border-gray-300 rounded-md"
            [class.border-red-500]="date?.invalid && date?.touched" />
          @if (date?.invalid && date?.touched) {
            <small class="text-red-500">Date is required</small>
          }
        </div>

        <!-- Description -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">
            Description <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            formControlName="description"
            class="w-full px-3 py-2 border border-gray-300 rounded-md"
            [class.border-red-500]="description?.invalid && description?.touched" />
          @if (description?.invalid && description?.touched) {
            <small class="text-red-500">Description is required</small>
          }
        </div>

        <!-- Is Recurring -->
        <div class="flex items-center">
          <input
            type="checkbox"
            formControlName="isRecurring"
            id="isRecurring"
            class="mr-2" />
          <label for="isRecurring" class="text-sm font-medium">Recurring Expense</label>
        </div>

        <!-- Recurring Day (only if recurring) -->
        @if (expenseForm.get('isRecurring')?.value) {
          <div>
            <label class="block text-sm font-medium mb-2">
              Recurring Day (1-31) <span class="text-red-500">*</span>
            </label>
            <input
              type="number"
              formControlName="recurringDay"
              min="1"
              max="31"
              class="w-full px-3 py-2 border border-gray-300 rounded-md"
              [class.border-red-500]="recurringDay?.invalid && recurringDay?.touched" />
            @if (recurringDay?.invalid && recurringDay?.touched) {
              <small class="text-red-500">Day must be between 1 and 31</small>
            }
            <small class="text-gray-500 block mt-1">Day of month to auto-generate this expense</small>
          </div>
        }

        <!-- Vendor -->
        <div>
          <label class="block text-sm font-medium mb-2">Vendor (Optional)</label>
          <input
            type="text"
            formControlName="vendor"
            class="w-full px-3 py-2 border border-gray-300 rounded-md" />
        </div>

        <!-- Invoice Number -->
        <div>
          <label class="block text-sm font-medium mb-2">Invoice Number (Optional)</label>
          <input
            type="text"
            formControlName="invoiceNumber"
            class="w-full px-3 py-2 border border-gray-300 rounded-md" />
        </div>

        <!-- Notes -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">Notes (Optional)</label>
          <textarea
            formControlName="notes"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button
          pButton
          type="button"
          label="Cancel"
          class="p-button-secondary"
          (click)="cancel()"
          [disabled]="loading()"></button>
        <button
          pButton
          type="submit"
          [label]="isEditMode() ? 'Update' : 'Create'"
          [disabled]="loading()"></button>
      </div>
    </form>
  </p-card>
</div>
