<div class="container mx-auto p-6 max-w-4xl">
  <p-card>
    <ng-template pTemplate="header">
      <div class="p-4">
        <h2 class="text-2xl font-bold">{{ isEditMode() ? 'Edit Expense' : 'Add New Expense' }}</h2>
      </div>
    </ng-template>

    <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Expense Type -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Type <span class="text-red-500">*</span>
          </label>
          <p-select
            formControlName="type"
            [options]="expenseTypeOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Select Type"
            class="w-full"
            [ngClass]="{'ng-invalid ng-dirty': type?.invalid && type?.touched}"></p-select>
          @if (type?.invalid && type?.touched) {
            <small class="text-red-500">Type is required</small>
          }
          <small class="text-gray-500 block mt-1">
            FIXED: Recurring monthly | VARIABLE: One-time | SHARED: Distributed across branches
          </small>
        </div>

        <!-- Category -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Category <span class="text-red-500">*</span>
          </label>
          <p-select
            formControlName="category"
            [options]="expenseCategoryOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Select Category"
            class="w-full"
            [ngClass]="{'ng-invalid ng-dirty': category?.invalid && category?.touched}"></p-select>
          @if (category?.invalid && category?.touched) {
            <small class="text-red-500">Category is required</small>
          }
        </div>

        <!-- Branch (only for FIXED and VARIABLE) -->
        @if (expenseForm.get('type')?.value !== 'SHARED') {
          <div>
            <label class="block text-sm font-medium mb-2">
              Branch <span class="text-red-500">*</span>
            </label>
            <p-select
              formControlName="branchId"
              [options]="branchOptions()"
              optionLabel="label"
              optionValue="value"
              placeholder="Select Branch"
              class="w-full"
              [ngClass]="{'ng-invalid ng-dirty': branchId?.invalid && branchId?.touched}"></p-select>
            @if (branchId?.invalid && branchId?.touched) {
              <small class="text-red-500">Branch is required</small>
            }
          </div>
        }

        <!-- Distribution Method (only for SHARED) -->
        @if (expenseForm.get('type')?.value === 'SHARED') {
          <div>
            <label class="block text-sm font-medium mb-2">
              Distribution Method <span class="text-red-500">*</span>
            </label>
            <p-select
              formControlName="distributionMethod"
              [options]="distributionMethodOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Select Distribution Method"
              class="w-full"
              [ngClass]="{'ng-invalid ng-dirty': distributionMethod?.invalid && distributionMethod?.touched}"></p-select>
            @if (distributionMethod?.invalid && distributionMethod?.touched) {
              <small class="text-red-500">Distribution method is required</small>
            }
            <small class="text-gray-500 block mt-1">
              EQUAL: Divide equally | PROPORTIONAL: Based on revenue
            </small>
          </div>
        }

        <!-- Amount -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Amount <span class="text-red-500">*</span>
          </label>
          <p-inputnumber
            formControlName="amount"
            mode="decimal"
            [minFractionDigits]="2"
            [maxFractionDigits]="2"
            [min]="0"
            class="w-full"
            [ngClass]="{'ng-invalid ng-dirty': amount?.invalid && amount?.touched}"></p-inputnumber>
          @if (amount?.invalid && amount?.touched) {
            <small class="text-red-500">Valid amount is required</small>
          }
        </div>

        <!-- Date -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Date <span class="text-red-500">*</span>
          </label>
          <p-datepicker
            formControlName="date"
            dateFormat="yy-mm-dd"
            [showIcon]="true"
            class="w-full"
            [ngClass]="{'ng-invalid ng-dirty': date?.invalid && date?.touched}"></p-datepicker>
          @if (date?.invalid && date?.touched) {
            <small class="text-red-500">Date is required</small>
          }
        </div>

        <!-- Description -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">
            Description <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            pInputText
            formControlName="description"
            class="w-full"
            [ngClass]="{'ng-invalid ng-dirty': description?.invalid && description?.touched}" />
          @if (description?.invalid && description?.touched) {
            <small class="text-red-500">Description is required</small>
          }
        </div>

        <!-- Is Recurring -->
        <div class="flex items-center">
          <p-checkbox
            formControlName="isRecurring"
            [binary]="true"
            inputId="isRecurring"
            class="mr-2"></p-checkbox>
          <label for="isRecurring" class="text-sm font-medium">Recurring Expense</label>
        </div>

        <!-- Recurring Day (only if recurring) -->
        @if (expenseForm.get('isRecurring')?.value) {
          <div>
            <label class="block text-sm font-medium mb-2">
              Recurring Day (1-31) <span class="text-red-500">*</span>
            </label>
            <p-inputnumber
              formControlName="recurringDay"
              [min]="1"
              [max]="31"
              [showButtons]="true"
              class="w-full"
              [ngClass]="{'ng-invalid ng-dirty': recurringDay?.invalid && recurringDay?.touched}"></p-inputnumber>
            @if (recurringDay?.invalid && recurringDay?.touched) {
              <small class="text-red-500">Day must be between 1 and 31</small>
            }
            <small class="text-gray-500 block mt-1">Day of month to auto-generate this expense</small>
          </div>
        }

        <!-- Vendor -->
        <div>
          <label class="block text-sm font-medium mb-2">Vendor (Optional)</label>
          <input
            type="text"
            pInputText
            formControlName="vendor"
            class="w-full" />
        </div>

        <!-- Invoice Number -->
        <div>
          <label class="block text-sm font-medium mb-2">Invoice Number (Optional)</label>
          <input
            type="text"
            pInputText
            formControlName="invoiceNumber"
            class="w-full" />
        </div>

        <!-- Notes -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">Notes (Optional)</label>
          <textarea
            pTextarea
            formControlName="notes"
            rows="3"
            class="w-full"></textarea>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <p-button
          type="button"
          label="Cancel"
          severity="secondary"
          (click)="cancel()"
          [disabled]="loading()"></p-button>
        <p-button
          type="submit"
          [label]="isEditMode() ? 'Update' : 'Create'"
          [disabled]="loading()"></p-button>
      </div>
    </form>
  </p-card>
</div>
