<div class="container mx-auto p-6 max-w-4xl">
  <p-card>
    <ng-template pTemplate="header">
      <div class="p-4">
        <h2 class="text-2xl font-bold">
          {{ isEditMode() ? 'Edit Class' : 'Create New Class' }}
        </h2>
        <p class="text-gray-500 mt-1">{{ courseName() }}</p>
      </div>
    </ng-template>

    <form [formGroup]="classForm" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Class Name -->
        <div class="field">
          <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
            Class Name <span class="text-red-500">*</span>
          </label>
          <input
            pInputText
            type="text"
            id="name"
            formControlName="name"
            placeholder="e.g., Section A, Morning Class"
            class="w-full"
            [class.ng-invalid]="classForm.get('name')?.invalid && classForm.get('name')?.touched"
            [class.ng-dirty]="classForm.get('name')?.touched" />
          @if (classForm.get('name')?.invalid && classForm.get('name')?.touched) {
            <small class="text-red-500">Class name is required (min 2 characters)</small>
          }
        </div>

        <!-- Class Code -->
        <div class="field">
          <label for="code" class="block text-sm font-medium text-gray-700 mb-2">
            Class Code <span class="text-red-500">*</span>
          </label>
          <input
            pInputText
            type="text"
            id="code"
            formControlName="code"
            placeholder="e.g., ROB-101-A"
            class="w-full"
            [class.ng-invalid]="classForm.get('code')?.invalid && classForm.get('code')?.touched"
            [class.ng-dirty]="classForm.get('code')?.touched" />
          @if (classForm.get('code')?.invalid && classForm.get('code')?.touched) {
            <small class="text-red-500">Class code is required (min 2 characters)</small>
          }
        </div>

        <!-- Branch -->
        <div class="field">
          <label for="branchId" class="block text-sm font-medium text-gray-700 mb-2">
            Branch <span class="text-red-500">*</span>
          </label>
          <p-select
            id="branchId"
            formControlName="branchId"
            [options]="branches()"
            optionLabel="label"
            optionValue="value"
            placeholder="Select a branch"
            styleClass="w-full"
            [class.ng-invalid]="classForm.get('branchId')?.invalid && classForm.get('branchId')?.touched"
            [class.ng-dirty]="classForm.get('branchId')?.touched">
          </p-select>
          @if (classForm.get('branchId')?.invalid && classForm.get('branchId')?.touched) {
            <small class="text-red-500">Branch is required</small>
          }
        </div>

        <!-- Instructor -->
        <div class="field">
          <label for="instructorId" class="block text-sm font-medium text-gray-700 mb-2">
            Instructor
          </label>
          <p-select
            id="instructorId"
            formControlName="instructorId"
            [options]="instructors()"
            optionLabel="label"
            optionValue="value"
            placeholder="Select an instructor (optional)"
            styleClass="w-full"
            [class.ng-invalid]="classForm.get('instructorId')?.invalid && classForm.get('instructorId')?.touched"
            [class.ng-dirty]="classForm.get('instructorId')?.touched">
          </p-select>
          <small class="text-gray-500">Defaults to course instructor if not specified</small>
        </div>

        <!-- Days of Week -->
        <div class="field md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Days of Week
          </label>
          <div class="flex flex-wrap gap-4">
            @for (day of daysOfWeek; track day.value) {
              <div class="flex items-center">
                <p-checkbox
                  [value]="day.value"
                  [ngModel]="isDaySelected(day.value)"
                  (ngModelChange)="onDayChange($event, day.value)"
                  [ngModelOptions]="{standalone: true}"
                  [binary]="true"
                  [inputId]="'day-' + day.value">
                </p-checkbox>
                <label [for]="'day-' + day.value" class="ml-2 text-sm">{{ day.label }}</label>
              </div>
            }
          </div>
          <small class="text-gray-500">Select the days when this class meets</small>
        </div>

        <!-- Start Time -->
        <div class="field">
          <label for="startTime" class="block text-sm font-medium text-gray-700 mb-2">
            Start Time
          </label>
          <input
            pInputText
            type="time"
            id="startTime"
            formControlName="startTime"
            class="w-full"
            [class.ng-invalid]="classForm.get('startTime')?.invalid && classForm.get('startTime')?.touched"
            [class.ng-dirty]="classForm.get('startTime')?.touched" />
        </div>

        <!-- End Time -->
        <div class="field">
          <label for="endTime" class="block text-sm font-medium text-gray-700 mb-2">
            End Time
          </label>
          <input
            pInputText
            type="time"
            id="endTime"
            formControlName="endTime"
            class="w-full"
            [class.ng-invalid]="classForm.get('endTime')?.invalid && classForm.get('endTime')?.touched"
            [class.ng-dirty]="classForm.get('endTime')?.touched" />
        </div>

        <!-- Start Date -->
        <div class="field">
          <label for="startDate" class="block text-sm font-medium text-gray-700 mb-2">
            Start Date <span class="text-red-500">*</span>
          </label>
          <p-datepicker
            id="startDate"
            formControlName="startDate"
            placeholder="Select start date"
            styleClass="w-full"
            [showIcon]="true"
            [class.ng-invalid]="classForm.get('startDate')?.invalid && classForm.get('startDate')?.touched"
            [class.ng-dirty]="classForm.get('startDate')?.touched">
          </p-datepicker>
          @if (classForm.get('startDate')?.invalid && classForm.get('startDate')?.touched) {
            <small class="text-red-500">Start date is required</small>
          }
        </div>

        <!-- End Date -->
        <div class="field">
          <label for="endDate" class="block text-sm font-medium text-gray-700 mb-2">
            End Date <span class="text-red-500">*</span>
          </label>
          <p-datepicker
            id="endDate"
            formControlName="endDate"
            placeholder="Select end date"
            styleClass="w-full"
            [showIcon]="true"
            [class.ng-invalid]="classForm.get('endDate')?.invalid && classForm.get('endDate')?.touched"
            [class.ng-dirty]="classForm.get('endDate')?.touched">
          </p-datepicker>
          @if (classForm.get('endDate')?.invalid && classForm.get('endDate')?.touched) {
            <small class="text-red-500">End date is required</small>
          }
        </div>

        <!-- Max Students -->
        <div class="field md:col-span-2">
          <label for="maxStudents" class="block text-sm font-medium text-gray-700 mb-2">
            Maximum Students (Optional)
          </label>
          <p-inputnumber
            id="maxStudents"
            formControlName="maxStudents"
            [min]="1"
            placeholder="Leave empty for unlimited"
            styleClass="w-full"
            [showButtons]="false">
          </p-inputnumber>
        </div>

        <!-- Notes -->
        <div class="field md:col-span-2">
          <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">
            Notes
          </label>
          <textarea
            pTextarea
            id="notes"
            formControlName="notes"
            rows="4"
            placeholder="Additional notes about this class"
            class="w-full">
          </textarea>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex justify-end gap-2 mt-6 pt-6 border-t">
        <button
          pButton
          type="button"
          label="Cancel"
          icon="pi pi-times"
          class="p-button-outlined"
          (click)="cancel()"
          [disabled]="loading()">
        </button>
        <button
          pButton
          type="submit"
          [label]="isEditMode() ? 'Update Class' : 'Create Class'"
          icon="pi pi-check"
          [disabled]="classForm.invalid || loading()">
          @if (loading()) {
            <i class="pi pi-spin pi-spinner"></i>
          }
        </button>
      </div>
    </form>
  </p-card>
</div>
