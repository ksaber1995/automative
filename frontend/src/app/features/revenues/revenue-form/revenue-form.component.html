<div class="container mx-auto p-6 max-w-4xl">
  <p-card>
    <ng-template pTemplate="header">
      <div class="p-4">
        <h2 class="text-2xl font-bold">{{ isEditMode() ? 'Edit Revenue' : 'Add New Revenue' }}</h2>
      </div>
    </ng-template>

    <form [formGroup]="revenueForm" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Branch -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Branch <span class="text-red-500">*</span>
          </label>
          <p-select
            formControlName="branchId"
            [options]="branches()"
            optionLabel="name"
            optionValue="id"
            placeholder="Select Branch"
            styleClass="w-full"
            [ngClass]="{'ng-invalid ng-dirty': branchId?.invalid && branchId?.touched}"></p-select>
          @if (branchId?.invalid && branchId?.touched) {
            <small class="text-red-500">Branch is required</small>
          }
        </div>

        <!-- Date -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Date <span class="text-red-500">*</span>
          </label>
          <p-datepicker
            formControlName="date"
            styleClass="w-full"
            [showIcon]="true"
            [ngClass]="{'ng-invalid ng-dirty': date?.invalid && date?.touched}"></p-datepicker>
          @if (date?.invalid && date?.touched) {
            <small class="text-red-500">Date is required</small>
          }
        </div>

        <!-- Amount -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Amount <span class="text-red-500">*</span>
          </label>
          <p-inputnumber
            formControlName="amount"
            mode="decimal"
            [minFractionDigits]="2"
            [maxFractionDigits]="2"
            styleClass="w-full"
            [ngClass]="{'ng-invalid ng-dirty': amount?.invalid && amount?.touched}"></p-inputnumber>
          @if (amount?.invalid && amount?.touched) {
            <small class="text-red-500">Valid amount is required</small>
          }
        </div>

        <!-- Payment Method -->
        <div>
          <label class="block text-sm font-medium mb-2">
            Payment Method <span class="text-red-500">*</span>
          </label>
          <p-select
            formControlName="paymentMethod"
            [options]="paymentMethods"
            placeholder="Select Payment Method"
            styleClass="w-full"
            [ngClass]="{'ng-invalid ng-dirty': paymentMethod?.invalid && paymentMethod?.touched}">
            <ng-template pTemplate="item" let-option>
              {{ option.replace('_', ' ') }}
            </ng-template>
            <ng-template pTemplate="selectedItem" let-option>
              {{ option.replace('_', ' ') }}
            </ng-template>
          </p-select>
          @if (paymentMethod?.invalid && paymentMethod?.touched) {
            <small class="text-red-500">Payment method is required</small>
          }
        </div>

        <!-- Description -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">
            Description <span class="text-red-500">*</span>
          </label>
          <input
            pInputText
            type="text"
            formControlName="description"
            class="w-full"
            [ngClass]="{'ng-invalid ng-dirty': description?.invalid && description?.touched}" />
          @if (description?.invalid && description?.touched) {
            <small class="text-red-500">Description is required</small>
          }
        </div>

        <!-- Course (Optional) -->
        <div>
          <label class="block text-sm font-medium mb-2">Course (Optional)</label>
          <p-select
            formControlName="courseId"
            [options]="courses()"
            optionLabel="name"
            optionValue="id"
            placeholder="None"
            styleClass="w-full"></p-select>
        </div>

        <!-- Student (Optional) -->
        <div>
          <label class="block text-sm font-medium mb-2">Student (Optional)</label>
          <p-select
            formControlName="studentId"
            [options]="students()"
            optionValue="id"
            placeholder="None"
            styleClass="w-full">
            <ng-template pTemplate="item" let-student>
              {{ student.firstName }} {{ student.lastName }}
            </ng-template>
            <ng-template pTemplate="selectedItem" let-student>
              {{ student.firstName }} {{ student.lastName }}
            </ng-template>
          </p-select>
        </div>

        <!-- Receipt Number -->
        <div>
          <label class="block text-sm font-medium mb-2">Receipt Number (Optional)</label>
          <input
            pInputText
            type="text"
            formControlName="receiptNumber"
            class="w-full" />
        </div>

        <!-- Notes -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">Notes (Optional)</label>
          <textarea
            pTextarea
            formControlName="notes"
            rows="3"
            class="w-full"></textarea>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button
          pButton
          type="button"
          label="Cancel"
          class="p-button-secondary"
          (click)="cancel()"
          [disabled]="loading()"></button>
        <button
          pButton
          type="submit"
          [label]="isEditMode() ? 'Update' : 'Create'"
          [disabled]="loading()"></button>
      </div>
    </form>
  </p-card>
</div>
