<div class="container-custom py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Branches</h1>
    <p-button
      label="Add Branch"
      icon="pi pi-plus"
      (onClick)="createBranch()"
    ></p-button>
  </div>

  <!-- Filter Section -->
  <p-card styleClass="mb-4">
    <div class="flex items-center gap-4">
      <label for="statusFilter" class="text-sm font-medium text-gray-700">
        Status Filter:
      </label>
      <p-select
        id="statusFilter"
        [(ngModel)]="statusFilter"
        [options]="statusFilterOptions"
        optionLabel="label"
        optionValue="value"
        styleClass="w-64"
      ></p-select>
      <div class="text-sm text-gray-500">
        Showing {{ branches().length }} of {{ allBranches().length }} branches
      </div>
    </div>
  </p-card>

  <p-card>
    <p-table
      [value]="branches()"
      [loading]="loading()"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} branches"
      [rowsPerPageOptions]="[10, 25, 50]"
      [globalFilterFields]="['name', 'code', 'city', 'email']"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="code">Code <p-sortIcon field="code"></p-sortIcon></th>
          <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
          <th pSortableColumn="city">City <p-sortIcon field="city"></p-sortIcon></th>
          <th>Contact</th>
          <th pSortableColumn="isActive">Status <p-sortIcon field="isActive"></p-sortIcon></th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-branch>
        <tr>
          <td>{{ branch.code }}</td>
          <td>{{ branch.name }}</td>
          <td>{{ branch.city }}, {{ branch.state }}</td>
          <td>
            <div class="text-sm">
              <div>{{ branch.phone }}</div>
              <div class="text-gray-600">{{ branch.email }}</div>
            </div>
          </td>
          <td>
            <p-tag
              [value]="branch.isActive ? 'Active' : 'Inactive'"
              [severity]="branch.isActive ? 'success' : 'danger'"
            ></p-tag>
          </td>
          <td>
            <div class="flex gap-2">
              <p-button
                icon="pi pi-eye"
                [rounded]="true"
                [text]="true"
                severity="info"
                (onClick)="viewBranch(branch)"
                pTooltip="View Details"
              ></p-button>
              <p-button
                icon="pi pi-pencil"
                [rounded]="true"
                [text]="true"
                severity="warn"
                (onClick)="editBranch(branch)"
                pTooltip="Edit"
              ></p-button>
              @if (branch.isActive) {
                <p-button
                  icon="pi pi-trash"
                  [rounded]="true"
                  [text]="true"
                  severity="danger"
                  (onClick)="confirmDelete(branch)"
                  pTooltip="Delete"
                ></p-button>
              }
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center py-8">
            <div class="text-gray-500">
              <i class="pi pi-inbox text-4xl mb-3"></i>
              <p>No branches found</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <app-delete-confirm-dialog
    [(visible)]="showDeleteDialog"
    [header]="'Delete Branch'"
    [message]="'Are you sure you want to delete ' + branchToDelete()?.name + '? This will permanently remove the branch and all associated data.'"
    (confirm)="deleteBranch()"
  ></app-delete-confirm-dialog>
</div>
